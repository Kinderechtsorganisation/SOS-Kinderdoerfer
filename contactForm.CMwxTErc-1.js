import{aO as j,m as w,S as n,c as b,i as C}from"./entry.0q7qStI1.js";import{i as g}from"./http.DdfkLhLC.js";import{u as T}from"./modalStore.BbZhz-_g.js";const k=(d,o,m=null)=>{const S=j(),{t:h}=w(),y=C(),i=T(),a=n(!1),f=n(!1),u=n(!1),r=n(""),e=b(()=>m?m.blok.form[0]:i.isModalOpened(o)&&i.openedModals[o].config?i.openedModals[o].config:null),p=b(()=>{let s=window.location.href.replace(/http(s)?:|\/\//gi,"");return d&&(s="Modal - "+s),s}),_=()=>{if(e&&e.value.success_page&&e.value.success_page.cached_url!=="undefined"&&e.value.success_page.cached_url!==""){let s=e.value.success_page.cached_url;e.value.success_page.linktype==="url"?window.location=s:e.value.success_page.linktype==="story"&&(s=s.startsWith("/")?s:"/"+s,i.closeModal(o),S.push(s))}};return{resetForm:()=>{u.value=null,r.value=null,a.value=!1,f.value=!1},submit:async({error:s,data:v})=>{if(u.value=null,r.value=null,s)return;const l={},E=["captchaSolution","captchaExpression","recipientUid"];l.captchaSolution=(v.find(([t,c])=>t==="captchaSolution")||[])[1],l.captchaExpression=(v.find(([t,c])=>t==="captchaExpression")||[])[1],e.value&&e.value.email_recipient&&(l.recipientUid=e.value.email_recipient),e.value&&e.value.email_subject&&(l.emailSubject=e.value.email_subject),l.attributes=v.filter(([t,c])=>!E.includes(t)).reduce((t,[c,M])=>(t[c]=M,t),{}),p.value&&(l.attributes["Website-URL"]=p.value);try{a.value=!0;const t=await fetch(y.public.CONTACT_MAIL_API_URL,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(l)}),c=await t.json();if(t.status===200)u.value=null,r.value=null,f.value=!0,d&&setTimeout(()=>i.closeModal(o),1e4),a.value=!0,_();else{if(g({data:c})){r.value="invalid",a.value=!1;return}a.value=!1,u.value=h("form.submitError")}}catch(t){if(g(t)){r.value="invalid",a.value=!1;return}a.value=!1,u.value=h("form.submitError")}},redirect:_,getUrl:p,formSubmitted:a,formSuccess:f,formError:u,captchaError:r}};export{k as u};
